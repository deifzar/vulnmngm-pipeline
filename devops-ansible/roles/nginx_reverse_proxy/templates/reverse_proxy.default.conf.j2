# Temporary HTTP-only config for initial Let's Encrypt certificate issuance
# This will be replaced with the full TLS config after cert is obtained

upstream {{ service_name }} {
  server {{ backend_host }}:{{ backend_port }} fail_timeout=0;
}

server {
  listen 80;
  server_name {{ service_domain }};

  # Let's Encrypt ACME challenge location (required for cert validation)
  location /.well-known/acme-challenge/ {
    root /var/www/html;
    allow all;
  }

  # Serve the application over HTTP temporarily
  # (Will redirect to HTTPS once certificate is obtained)
  location / {
    proxy_pass http://{{ service_name }};
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}
